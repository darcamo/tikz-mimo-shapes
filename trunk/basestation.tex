\makeatletter


% xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
% xxxxxxxxxxxxxxx BaseStation Shape xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
% xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
\pgfdeclareshape{BaseStation}{
  \savedmacro\shapewidth{
    \def\shapewidth{\pgfkeysvalueof{/pgf/minimum width}}
  }

  \savedmacro\shapeheight{
    \def\shapeheight{\pgfkeysvalueof{/pgf/minimum height}}
  }

  % \savedmacro\innersep{
  %   \def\shapeheight{\pgfkeysvalueof{/pgf/minimum height}}
  % }

  \savedanchor{\center}{
    \pgf@x=0pt
    \pgf@y=0pt
  }

  \savedanchor{\northeast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgf@x=0.5\pgf@xa
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.5\pgf@ya
  }

  \savedanchor{\southwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgf@x=-0.5\pgf@xa
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=-0.5\pgf@ya
  }

  \savedanchor{\BaseAsouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=-0.5\pgf@ya
    \pgf@x=-0.2\pgf@xa
  }

  \savedanchor{\BaseAnortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=-0.05\pgf@ya
    \pgf@x=0.2\pgf@xa
  }

  \savedanchor{\BaseBsoutheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=-0.05\pgf@ya
    \pgf@x=0.15\pgf@xa
    % \advance\pgf@x by -0.5mm
  }

  \savedanchor{\BaseBnorthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.15\pgf@ya
    \pgf@x=-0.15\pgf@xa
    % \advance\pgf@x by 0.5mm
  }

  \savedanchor{\BaseCsouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.15\pgf@ya
    \pgf@x=-0.1\pgf@xa
    % \advance\pgf@x by 0.5mm
  }
  
  \savedanchor{\BaseCnortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.30\pgf@ya
    \pgf@x=0.1\pgf@xa
    %\advance\pgf@x by 0.5mm
  }
  
  % Maybe I don't need this savedanchor
  \savedanchor{\MiddleAntennasouth}{
    \pgf@x=0pt
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.29\pgf@ya
  }


  \savedanchor{\AntennaConnectorsouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=-0.5\pgf@xa
    \pgf@y=0.38\pgf@ya
  }

  \savedanchor{\AntennaConnectornortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=0.5\pgf@xa
    \pgf@y=0.42\pgf@ya
  }

  \savedanchor{\MiddleAntennasouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgf@x=-0.15\pgf@xa
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.29\pgf@ya
  }

  \savedanchor{\MiddleAntennanortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgf@x=0.15\pgf@xa
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@y=0.5\pgf@ya
  }

  \savedanchor{\LeftAntennasouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=-0.5\pgf@xa
    \pgf@y=0.29\pgf@ya
  }

  \savedanchor{\LeftAntennanortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=-0.25\pgf@xa
    \pgf@y=0.5\pgf@ya
  }

  \savedanchor{\RightAntennasouthwest}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=0.25\pgf@xa
    \pgf@y=0.29\pgf@ya
  }

  \savedanchor{\RightAntennanortheast}{
    \pgfmathsetlength\pgf@xa{\shapewidth}
    \pgfmathsetlength\pgf@ya{\shapeheight}
    \pgf@x=0.5\pgf@xa
    \pgf@y=0.5\pgf@ya
  }
  
  % xxxxxxxxxx Regular Anchors xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  % \anchor{base A south west}{\BaseAsouthwest}
  % \anchor{base A north east}{\BaseAnortheast}
  % \anchor{base B south east}{\BaseBsoutheast}
  % \anchor{base B north west}{\BaseBnorthwest}
  % \anchor{base C south west}{\BaseCsouthwest}
  % \anchor{base C north east}{\BaseCnortheast}
  \anchor{text}
  {
    \center
    \advance\pgf@x by -0.5\wd\pgfnodeparttextbox
  }

  % We define the savedanchors "northeast" and "southwest". With these two
  % defined we can inherit code for the regular anchors from the
  % rectangle shape (even thought the northeast and southwest saved anchors
  % in the rectangle shape are different from ours)..
  \inheritanchor[from=rectangle]{center}
  \inheritanchor[from=rectangle]{north}
  \inheritanchor[from=rectangle]{east}
  \inheritanchor[from=rectangle]{south}
  \inheritanchor[from=rectangle]{west}
  \inheritanchor[from=rectangle]{north east}
  \inheritanchor[from=rectangle]{north west}
  \inheritanchor[from=rectangle]{south west}
  \inheritanchor[from=rectangle]{south east}
  %\inheritanchor[from=rectangle]{text}
  % xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

  % We can even inherit the "angle" anchors.
  \inheritanchorborder[from=rectangle]%
  
  \backgroundpath{
    % Scope for the Base
    \begin{scope}
      % Draw the bottom base
      \pgfpathrectanglecorners
      {\BaseAsouthwest}
      {\BaseAnortheast}

      % Draw the middle base
      \pgfpathrectanglecorners
      {\BaseBsoutheast}
      {\BaseBnorthwest}

      % Draw the bottom base
      \pgfpathrectanglecorners
      {\BaseCsouthwest}
      {\BaseCnortheast}

      \pgfusepath{stroke,fill}
    \end{scope}

    % Scope for the antenna connector
    \begin{scope}
      % Draw Antenna connector
      \pgfpathrectanglecorners
      {\AntennaConnectorsouthwest}
      {\AntennaConnectornortheast}

      \pgfusepath{stroke,fill}
    \end{scope}

    % Scope for the antennas
    \begin{scope}
      % Draw the middle antenna
      \pgfpathrectanglecorners
      {\MiddleAntennasouthwest}
      {\MiddleAntennanortheast}
      
      % Draw the Left antenna
      \pgfpathrectanglecorners
      {\LeftAntennasouthwest}
      {\LeftAntennanortheast}
      
      % Draw the Right antenna
      \pgfpathrectanglecorners
      {\RightAntennasouthwest}
      {\RightAntennanortheast}

      \pgfusepath{stroke,fill}
    \end{scope}
  }
}
% xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
% xxxxxxxxxxxxxxx END xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
% xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx


\makeatother

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "testbasestation.tex"
%%% TeX-PDF-mode: t
%%% End: 
